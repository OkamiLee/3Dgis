<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
	<title></title>
	<style>
	  	html, body, #viewDiv {padding: 0;margin: 0;height: 100%;width: 100%;}
	  	.dot_box{z-index:2;position: fixed;width: 20px; height: 20px; background: #0080FF; border-radius: 50%;}
		.line_ele{z-index:2;position: absolute;top: 50%;left: 0;margin-top: -1px;height: 1px; border-bottom: 1px solid #0080FF;}
		.box{z-index:2;display: none;position: fixed; width: 300px; height: 300px; border: 2px solid #ddd;}
	</style>
	<link rel="stylesheet" href="https://js.arcgis.com/4.5/esri/css/main.css">
	<script src="https://js.arcgis.com/4.5/"></script>
  	<script src="http://image.wap.zhuogan.cn/smartApp/js/h5/js/jquery-1.10.1.min.js"></script>
</head>
<body>
  	<div id="viewDiv"></div>
	<div class="box"></div>
</body>
	<script>
		var imgNum = 0;
 		var timer = null;
		require([
			"esri/Map",
	      	"esri/views/SceneView", 
      		"esri/layers/ElevationLayer",
      		"esri/geometry/Circle",
      		"esri/layers/BaseElevationLayer",
      		"esri/layers/FeatureLayer",
      		"esri/symbols/SimpleFillSymbol",
      		"esri/layers/support/LabelClass",
      		"esri/symbols/ExtrudeSymbol3DLayer",
      		"esri/symbols/TextSymbol",
	      	"esri/Graphic",
	      	"esri/Camera",
      		"dojo/on",
	      	"dojo/domReady!"
		], function(Map, SceneView,ElevationLayer,Circle, FeatureLayer,TextSymbol,ExtrudeSymbol3DLayer,SimpleFillSymbol, LabelClass,BaseElevationLayer,Graphic,on,Camera){
		  	var map = new Map({
		    	basemap: "satellite",
		    	showLabels : true,
		    	maxZoom:15,
		    	zoom:7,
		    	minZoom:6, 
		    	logo:false,
		    	height:"100%",
		    	fadeOnZoom: true
		  	});
		  	
		  	var view = new SceneView({
		    	container: "viewDiv",     
		    	map: map,                 
	    		scale: 50000000,          
	    		center: [139.24, 65.36],
	    		qualityProfile: "high",
	    		environment: {
          			lighting: {
            			directShadowsEnabled: true,
            			ambientOcclusionEnabled: true
          			},
			        atmosphere: {
			            quality: "high"
			        }
        		}
		  	});
			var dataArr = [[127.679854, 44.519471,'测试点一',1],[128.003585, 44.419471,'测试点二',2],[127.17, 44.93,'测试点三',3]]
	  		view.on("click", function(event){ 
	  			var screenPoint = {//当前点击的经纬度
				  	x: event.x,
				  	y: event.y
				};
			  	view.hitTest(screenPoint).then(function(response){//搜索与指定屏幕坐标相交的图形。
			    	if(response.results[0].graphic){//如果当前点击位置存在点位
			    		for(var i=0;i<dataArr.length;i++){
			    			if(response.results[0].graphic.attr.id===(i+1)){//执行点位信息动画
			    				alert((i+1))
			    			}
			    		}
			    	}
			  	});
			});
	  		view.then(function() {// 地图加载完成
	        	setTimeout(function(){
	        		view.goTo({// 视角切换动画
					  	center: [ 127.17,44.93],//终点坐标
					 	heading: 360, // 面向正南
					 	z: 10000,
	  					tilt:40,//视图角度cos
	  					zoom: 10,//放大等级
					})
	        	},1000);
	        }, function(error){
	        	alert('加载失败,稍后重新加载');
	        	window.reload();
			});
	        var pointArr = [127.999854, 44.519471,128.005901, 44.510887,128.003585, 44.505702,128.016395, 44.497518,128.044869, 44.506193,128.069113, 44.499191,128.104942, 44.500773,128.114602, 44.506281,128.120514, 44.516506,128.133288, 44.520131,128.143249, 44.516706,128.164115, 44.517801,128.17221, 44.509867,128.193065, 44.503319,128.217848, 44.511102,128.239442, 44.528846,128.246184, 44.543496,128.238521, 44.550671,128.242028, 44.553214,128.241495, 44.558529,128.253319, 44.559782,128.260097, 44.551442,128.268111, 44.551059,128.26657, 44.544922,128.273543, 44.541467,128.275935, 44.536616,128.260089, 44.521321,128.261224, 44.511568,128.248857, 44.494381,128.252163, 44.489526,128.240503, 44.486448,128.235872, 44.479037,128.239891, 44.471127,128.259334, 44.460799,128.258354, 44.452158,128.232362, 44.45081,128.216545, 44.437876,128.207189, 44.41798,128.193623, 44.370641,128.175529, 44.353291,128.168841, 44.350722,128.160376, 44.361422,128.152703, 44.363657,128.142275, 44.363335,128.129946, 44.3553,128.117304, 44.364671,128.10123, 44.360532,128.086444, 44.373055,128.078742, 44.375828,128.075298, 44.381549,128.067805, 44.363745,128.055526, 44.35648,128.057289, 44.352524,128.067794, 44.347478,128.061932, 44.33683,128.069787, 44.325393,128.069451, 44.313972,128.084852, 44.313056,128.087716, 44.30266,128.09315, 44.29972,128.103609, 44.301396,128.106541, 44.297278,128.094455, 44.281251,128.0712, 44.270858,128.06901, 44.257931,128.072773, 44.254605,128.096702, 44.252431,128.098291, 44.248644,128.092777, 44.24442,128.109009, 44.234545,128.111054, 44.221358,128.107324, 44.2189,128.094907, 44.220753,128.097646, 44.1876,128.07743, 44.187353,128.065797, 44.175681,128.07451, 44.171296,128.078098, 44.166023,128.093125, 44.166567,128.091166, 44.150767,128.105864, 44.141096,128.09153, 44.135446,128.051329, 44.111105,128.035999, 44.113436,128.013311, 44.100992,127.969107, 44.093292,127.954253, 44.093198,127.915518, 44.070935,127.894713, 44.075426,127.870354, 44.067507,127.856164, 44.078878,127.851042, 44.089223,127.82616, 44.087541,127.817014, 44.092699,127.799442, 44.076572,127.793854, 44.074918,127.769663, 44.088973,127.760145, 44.09062,127.736674, 44.105303,127.741197, 44.122065,127.740319, 44.135829,127.732942, 44.148451,127.734423, 44.152382,127.727841, 44.156796,127.725826, 44.162257,127.730836, 44.193951,127.726284, 44.207089,127.720698, 44.20778,127.714938, 44.204377,127.704188, 44.182001,127.684462, 44.173452,127.677536, 44.176692,127.671467, 44.18442,127.620993, 44.200643,127.618013, 44.211167,127.605408, 44.225734,127.599442, 44.245868,127.601472, 44.249454,127.62934, 44.263962,127.628605, 44.279907,127.566381, 44.342849,127.527605, 44.36519,127.525671, 44.383895,127.487259, 44.404525,127.484093, 44.413291,127.487034, 44.417851,127.505595, 44.428736,127.508632, 44.439597,127.502911, 44.449782,127.480238, 44.472545,127.471109, 44.476149,127.470499, 44.48405,127.484313, 44.490892,127.45911, 44.510838,127.468965, 44.518447,127.495041, 44.527766,127.538136, 44.523287,127.543597, 44.525713,127.568371, 44.557489,127.498916, 44.595695,127.473059, 44.601306,127.412055, 44.627368,127.395731, 44.624389,127.37763, 44.624597,127.32515, 44.636963,127.29464, 44.63699,127.281726, 44.633602,127.269151, 44.612201,127.26243, 44.615774,127.24925, 44.615631,127.242238, 44.631795,127.23767, 44.632276,127.22378, 44.625827,127.218276, 44.626651,127.217875, 44.632221,127.225433, 44.641475,127.225494, 44.646373,127.213703, 44.653885,127.179408, 44.649591,127.172724, 44.644719,127.177815, 44.642381,127.178986, 44.633962,127.166518, 44.634143,127.159152, 44.618228,127.145063, 44.616498,127.147029, 44.613531,127.140511, 44.611273,127.133166, 44.612709,127.121439, 44.620816,127.09989, 44.622123,127.094528, 44.613099,127.093589, 44.599991,127.082693, 44.594132,127.061996, 44.575084,127.054386, 44.571879,127.051624, 44.574389,127.048323, 44.58975,127.036693, 44.596464,127.034964, 44.601451,127.039054, 44.611741,127.045814, 44.617041,127.044852, 44.642277,127.05012, 44.655987,127.038894, 44.674574,127.033373, 44.676732,127.040891, 44.688496,127.040414, 44.70489,127.045402, 44.719898,127.001533, 44.773214,126.989228, 44.831516,126.998356, 44.844587,126.999968, 44.856647,127.008928, 44.863131,127.00965, 44.868932,127.002776, 44.877796,127.021289, 44.905628,127.078867, 44.916405,127.080515, 44.925726,127.089463, 44.922165,127.095098, 44.931724,127.094072, 44.942556,127.08791, 44.949711,127.097101, 44.948862,127.099233, 44.951186,127.091742, 44.96391,127.081596, 44.964145,127.085237, 44.970728,127.075361, 44.974815,127.077591, 44.981674,127.071254, 44.987837,127.064611, 44.987241,127.063696, 44.994867,127.055467, 45.000419,127.047338, 44.997074,127.043593, 44.999062,127.045609, 45.003927,127.056608, 45.01124,127.043041, 45.013126,127.040855, 45.022656,127.021757, 45.031219,127.016964, 45.047644,127.008039, 45.052548,126.994333, 45.071152,126.981433, 45.074305,126.97585, 45.079593,126.972371, 45.088302,126.977754, 45.104582,126.97265, 45.113984,126.975822, 45.121946,126.96101, 45.128955,126.969292, 45.138294,126.964807, 45.143699,126.950401, 45.144037,126.936471, 45.136107,126.927284, 45.148384,126.905329, 45.146133,126.889352, 45.147725,126.879862, 45.143598,126.866375, 45.145959,126.860992, 45.151435,126.844359, 45.138079,126.838572, 45.142767,126.83728, 45.151233,126.829279, 45.152951,126.821698, 45.143606,126.817021, 45.142035,126.810778, 45.148939,126.80171, 45.139535,126.793448, 45.150267,126.792874, 45.16506,126.777361, 45.170291,126.770678, 45.179445,126.763095, 45.182575,126.753799, 45.182806,126.748047, 45.179911,126.736341, 45.180943,126.739818, 45.189532,126.735767, 45.192745,126.718952, 45.194583,126.697892, 45.191012,126.681367, 45.201221,126.672712, 45.198696,126.666798, 45.20238,126.662719, 45.213643,126.649888, 45.217565,126.652945, 45.227926,126.636873, 45.23171,126.628332, 45.241466,126.616309, 45.242716,126.60527, 45.247362,126.602669, 45.240666,126.598251, 45.238827,126.594608, 45.242323,126.599123, 45.252496,126.580267, 45.257895,126.562607, 45.256166,126.560919, 45.261357,126.567546, 45.262691,126.562965, 45.266224,126.565962, 45.267627,126.56233, 45.268569,126.564064, 45.271636,126.569429, 45.271493,126.574154, 45.277097,126.581886, 45.277594,126.585584, 45.283073,126.57986, 45.288059,126.583436, 45.29269,126.593244, 45.2924,126.59118, 45.294831,126.6004, 45.299705,126.599073, 45.309537,126.604792, 45.313163,126.606868, 45.310798,126.61981, 45.309272,126.62303, 45.320604,126.648815, 45.324406,126.654783, 45.331789,126.657521, 45.347921,126.644841, 45.365417,126.646052, 45.386592,126.640166, 45.38821,126.632533, 45.39948,126.63276, 45.408116,126.624491, 45.432735,126.652347, 45.441294,126.660594, 45.427551,126.700712, 45.439055,126.716018, 45.439796,126.723754, 45.446642,126.749483, 45.442798,126.763351, 45.445351,126.78046, 45.443401,126.788926, 45.444856,126.807182, 45.439307,126.808321, 45.434689,126.821017, 45.438942,126.831601, 45.435935,126.839792, 45.438692,126.865467, 45.428869,126.876407, 45.413426,126.887688, 45.409344,126.912368, 45.383266,126.921944, 45.3806,126.934989, 45.370443,126.944529, 45.371364,126.961337, 45.378208,126.989185, 45.380281,127.016894, 45.387417,127.026221, 45.375291,127.046166, 45.371752,127.048915, 45.356059,127.056034, 45.351019,127.067035, 45.354943,127.072107, 45.352426,127.079606, 45.353606,127.090727, 45.345053,127.09164, 45.338756,127.101538, 45.33334,127.128672, 45.332309,127.129002, 45.324085,127.133735, 45.32366,127.131947, 45.320444,127.137212, 45.317882,127.121261, 45.305829,127.131253, 45.279698,127.153512, 45.280763,127.175391, 45.288309,127.187981, 45.282736,127.18054, 45.28073,127.175445, 45.275713,127.17234, 45.263412,127.184737, 45.273031,127.20383, 45.272657,127.216889, 45.250394,127.232037, 45.245458,127.236708, 45.247576,127.254974, 45.247852,127.259645, 45.236654,127.271229, 45.231965,127.292637, 45.213231,127.292785, 45.209003,127.287892, 45.207586,127.27336, 45.212104,127.265997, 45.211605,127.260555, 45.207806,127.25565, 45.193693,127.265758, 45.186814,127.275294, 45.184157,127.293322, 45.190952,127.305322, 45.192111,127.342214, 45.185656,127.359093, 45.194383,127.372882, 45.191802,127.385757, 45.178971,127.405686, 45.176829,127.437795, 45.16364,127.461441, 45.140094,127.478413, 45.129119,127.502323, 45.127543,127.506105, 45.118947,127.523371, 45.106132,127.530511, 45.10263,127.562348, 45.098198,127.571452, 45.092478,127.573501, 45.07701,127.599755, 45.068595,127.605738, 45.060682,127.620839, 45.056936,127.63986, 45.067168,127.649322, 45.062382,127.647729, 45.046389,127.652525, 45.041235,127.659904, 45.040159,127.660044, 45.042405,127.663359, 45.042268,127.660969, 45.044908,127.665688, 45.046376,127.675534, 45.043002,127.688809, 45.033593,127.693288, 45.035871,127.704614, 45.032331,127.715633, 45.034787,127.730062, 45.031238,127.735546, 45.015392,127.731742, 45.011369,127.737538, 45.002393,127.737721, 44.99518,127.753831, 44.987369,127.753407, 44.981781,127.738361, 44.965577,127.748085, 44.956444,127.755282, 44.957187,127.762867, 44.962439,127.787444, 44.966875,127.800724, 44.965153,127.811231, 44.966873,127.837408, 44.9519,127.856211, 44.948832,127.866753, 44.93598,127.863683, 44.931676,127.865463, 44.928817,127.878815, 44.921239,127.891256, 44.923208,127.899246, 44.911362,127.897182, 44.902859,127.900482, 44.886778,127.89459, 44.881663,127.902771, 44.875087,127.903259, 44.866044,127.899759, 44.859068,127.883802, 44.853482,127.879129, 44.846094,127.88244, 44.84319,127.898516, 44.840637,127.917337, 44.843519,127.929533, 44.842021,127.931087, 44.827672,127.942241, 44.810715,127.938058, 44.798084,127.96264, 44.77517,127.979857, 44.777143,127.983078, 44.775128,127.982025, 44.767703,127.972656, 44.758562,127.974263, 44.746427,127.969577, 44.740137,127.973213, 44.735574,127.983368, 44.732816,127.982592, 44.72553,127.9889, 44.723816,128.004711, 44.729039,128.029964, 44.729403,128.048813, 44.725462,128.067933, 44.728011,128.072618, 44.723642,128.071634, 44.703663,128.054111, 44.687394,128.055784, 44.672406,128.052874, 44.665342,128.026826, 44.652826,128.019676, 44.634271,128.019016, 44.613688,128.028664, 44.6076,128.02356, 44.586473,128.025712, 44.584298,128.020535, 44.576754,128.010816, 44.571335,128.019419, 44.566103,128.019653, 44.553138,128.015504, 44.546302,128.003467, 44.538961,127.999854, 44.519471];
			var latArr = new Array();
			var lngArr = new Array();
			var newPointArr = new Array();//转换后的二维数组
			for(var i=0;i<pointArr.length;i++){
				if(i%2==0){
					latArr.push(pointArr[i]);
				}else{
					lngArr.push(pointArr[i]);
				}
			}
			for(var i=0;i<lngArr.length;i++){
				newPointArr.push([latArr[i],lngArr[i]]);
			}
			for(var i in dataArr){
				var point1 = {//点位顶部标注
		          	type: "point", 
		          	x: dataArr[i][0],
		          	y: dataArr[i][1],
		          	z: 100
		        };
		        var markerSymbol1 = {
		          	type: "simple-marker", 
		          	color: [72,149,227],
		          	outline: { 
		            	color: [29,213, 242],
		            	width: 2
		          	}
		        };
		        var pointGraphic1 = new Graphic({
		          	geometry: point1,
		          	symbol: markerSymbol1,
		          	attr:{"id":dataArr[i][3]}
		        });
				var polyline = {//折线图形
		          	type: "polyline", 
		          	paths: [
		            	[dataArr[i][0], dataArr[i][1], 0],
		            	[dataArr[i][0], dataArr[i][1], 100]
		          	]
		        };
		        var lineSymbol = {
		          	type: "simple-line", 
		          	color: [44, 123, 146],
		          	width: 2
		        };
		        var polylineGraphic = new Graphic({
		          	geometry: polyline,
		          	symbol: lineSymbol
		        });
		        var circleGeometry = new Circle({//创建标注底座
				    center: [dataArr[i][0],dataArr[i][1]],//圆心
				    radius: 50//半径
				});
				var circleSymbol = {//标注底座填充
				  	type: "simple-fill",  
				  	color: [ 72,149,227, 0.4 ],//颜色
				  	style: "solid",
				  	outline: { //边框
				    	color:[ 29,213, 242, 0.2 ],
				    	width: 50
				  	}
				};
				var circleGraphic = new Graphic({//创建图像
			        geometry: circleGeometry,//几何图像
			        symbol: circleSymbol//填充
		      	});
		      	var textSymbol = {//文字信息
				  	type: "text",  
				  	color: "white",
				  	haloColor: [ 29,213, 242 ],//边框
				  	haloSize: "1px",
				  	text: dataArr[i][2],//文本
				 	xoffset: 200,//偏移
				  	yoffset: 1000,
				  	font: {  
				    	size: 14,
				    	family: "sans-serif",//字体
				    	weight: "bolder"//加粗类型
				  	}
				};
		      	var textGraphic = new Graphic({//创建文本图像
			        geometry: {
			        	type: "point", 
			        	longitude: dataArr[i][0],
			        	latitude: dataArr[i][1]
			        },
			        symbol: textSymbol
			    });
		        view.graphics.addMany([polylineGraphic,textGraphic,pointGraphic1,circleGraphic]);//添加到视图
			}
		    var polygon = {//多边形
	        	type: "polygon", 
	        	rings:newPointArr,//多边形点位经纬度
	        	spatialReference: { wkid: 4326 }
	      	};
	      	var fillSymbol = {
			  	type: "polygon-3d",  // 多边形类型
			  	symbolLayers: [{//立体多边形
				    type: "extrude",  
				    size: 2000,  // 高度
				    depth :4000,
				    height:1000,
				    material: { color: [77, 147, 60,0.2] },
				    outline: {
		              	color: "white",
		              	size: 2
		            }
			  	}]
			};
	      	var polygonGraphic = new Graphic({
		        geometry: polygon,
		        symbol: fillSymbol
	      	});
		    //view.graphics.addMany([pointGraphic,polygonGraphic]);
			view.graphics.addMany([polygonGraphic]);
		});
		
	
	 
/*	(function(idnex){
		var point = {//创建点位
	        type: "point", 
	        longitude: dataArr[i][0],
	        latitude: dataArr[i][1],
	        z: 200
	    };
	    var textSymbol = {
		  	type: "text",  
		  	color: "white",
		  	haloColor: "black",
		  	haloSize: "5px",
		  	text: dataArr[i][2],
		 	xoffset: 200,
		  	yoffset: 1000,
		  	font: {  
		    	size: 10,
		    	family: "sans-serif",
		    	weight: "bolder"
		  	}
		};
	    var markerSymbol = {
	        type: "point-3d", 
	        symbolLayers: [{
			    type: "icon",  
				resource: {
          			href: "img/preview.png"
        		},
        		size: 20,
	            outline: {
	              	color: "white",
	              	size: 2
	            }
			}]
	    };
	    var pointGraphic = new Graphic({
	        geometry: {
	        	type: "point", 
	        	longitude: dataArr[i][0],
	        	latitude: dataArr[i][1]
	        },
	        symbol: markerSymbol,
	        attr:{"id":dataArr[i][3]}//点位唯一标识  用于添加事件
	    });
	    var textGraphic = new Graphic({
	        geometry: {
	        	type: "point", 
	        	longitude: dataArr[i][0]+0.0003,
	        	latitude: dataArr[i][1]+0.0001
	        },
	        symbol: textSymbol
	    });
	    view.graphics.addMany([pointGraphic,textGraphic]);
	})(i) */
	 
	
	</script>